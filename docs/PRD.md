# Wallpaper Mate - 产品需求文档 (PRD)

## 1. 项目概述

**项目名称:** Wallpaper Mate

**项目描述:** 一款基于 Tauri 构建的 macOS 壁纸管理器。自动获取、生成并设置精美的壁纸，提供接近原生的使用体验。

**目标平台:** macOS（主要平台），未来通过 Tauri 跨平台能力支持 Windows。

**核心价值:** 提供一款轻量级、原生体验的壁纸管理应用，自动保持桌面充满美丽的图片。

---

## 2. 技术方案

### 2.1 技术栈选择

#### 决策矩阵：Swift vs Tauri

| 因素 | Swift (原生) | Tauri (Rust + Web) | 选择 |
|------|--------------|-------------------|------|
| **原生体验** | ⭐⭐⭐⭐⭐ 最佳 | ⭐⭐⭐⭐ 非常好 | Swift 胜出 |
| **应用体积** | ⭐⭐⭐⭐⭐ 最小 | ⭐⭐⭐⭐ 小 (3-10MB) | Swift 胜出 |
| **Vibe Coding / AI 友好** | ⭐⭐⭐ 一般 | ⭐⭐⭐⭐⭐ 优秀 | **Tauri 胜出** |
| **跨平台** | ❌ 仅 macOS | ✅ macOS + Windows + Linux | **Tauri 胜出** |
| **开发速度** | ⭐⭐⭐ 一般 | ⭐⭐⭐⭐ 快 | Tauri 胜出 |
| **生态系统** | 仅 Apple | 庞大的 Rust + Web 生态 | Tauri 胜出 |
| **壁纸 API 访问** | 原生 NSWorkspace | `wallpaper` crate (成熟) | 两者都简单 |

#### 最终决策：**Tauri**

**关键原因：**
1. **Vibe Coding** - 前端框架（React/Vue/Svelte）对 AI 模型更熟悉，更容易维护
2. **跨平台** - 未来 Windows 兼容性无需重写代码库
3. **小体积** - 比 Electron 小得多（3-10MB vs 100MB+）
4. **壁纸 API** - `wallpaper` crate 提供简单的跨平台壁纸管理
5. **成熟生态** - Rust 后端 + 现代 Web 前端

### 2.2 技术栈详情

**后端 (Rust)：**
- Tauri 2.0（最新稳定版）
- `wallpaper` crate (v3.2+) 用于系统壁纸管理
- `tokio` 用于异步操作
- `reqwest` 用于 HTTP 请求（壁纸获取）
- `serde` 用于序列化

**前端 (Web)：**
- **框架：** React（配合 Vite）- 推荐，适合 AI 代码生成
- **UI 库：** shadcn/ui 或类似库，提供现代化、可访问的组件
- **状态管理：** Zustand 或 React Context API
- **样式：** TailwindCSS 用于快速开发

**系统集成：**
- **菜单栏：** Tauri System Tray API（原生 macOS 菜单栏）
- **通知：** macOS 原生通知
- **文件系统：** 壁纸缓存的持久化存储

---

## 3. 功能需求

### 3.1 优先级矩阵

| 功能 | 优先级 | 复杂度 | 目标版本 |
|------|--------|--------|----------|
| 壁纸获取 | **P0** | 中等 | v1.0 |
| 自动壁纸替换 | **P0** | 中等 | v1.0 |
| 菜单栏应用 | **P0** | 低 | v1.0 |
| AI 壁纸生成 | **P1** | 高 | v2.0 |
| Windows 支持 | **P2** | 中等 | 未来 |
| 高级调度 | **P1** | 低 | v1.5 |

### 3.2 详细功能

#### 第一阶段：MVP (v1.0)

**1. 壁纸获取 (P0)**
- 支持热门壁纸来源：
  - Unsplash API（免费，高质量）
  - Wallhaven（热门动漫/艺术壁纸）
  - Bing 每日壁纸 API
  - 自定义 URL 支持
- 本地下载和缓存壁纸
- 按分辨率、分类、标签过滤
- 设置前预览壁纸

**2. 自动壁纸替换 (P0)**
- 手动：一键更换壁纸
- 定时器：设置间隔（如每 30 分钟、1 小时、每天）
- 触发：启动时、从睡眠唤醒时
- 支持多显示器

**3. 菜单栏应用 (P0)**
- macOS 菜单栏中的系统托盘图标
- 快速操作：
  - 下一张壁纸
  - 暂停/恢复自动更换
  - 打开设置
  - 查看当前壁纸信息
- 状态指示器（如自动更换激活/暂停）

**4. 设置管理 (P0)**
- 壁纸来源选择
- 更改频率配置
- 分辨率偏好
- 缓存管理
- 应用启动时自动运行

**5. 壁纸历史 (P1)**
- 保留最近 N 张壁纸的历史记录
- 一键恢复到上一张壁纸
- 将壁纸标记为收藏

#### 第二阶段：增强体验 (v1.5)

**6. 高级调度 (P1)**
- 为特定时间设置特定壁纸（如早晨、晚上）
- 昼/夜自动切换
- 自定义计划（周一 = 自然壁纸等）

**7. 壁纸集合 (P1)**
- 创建自定义集合（如"自然"、"抽象"、"极简主义"）
- 批量下载壁纸到集合
- 在集合内随机播放

#### 第三阶段：AI 生成 (v2.0)

**8. AI 壁纸生成 (P1)**
- 集成 AI 图像 API：
  - Stable Diffusion API（Replicate、本地 SD）
  - DALL-E API（OpenAI）
  - Midjourney API（如果可用）
- 基于提示词生成
- 风格预设（写实、动漫、抽象等）
- 负面提示词支持
- 宽高比控制

**9. 智能策展 (P2)**
- 学习用户偏好（基于收藏/跳过）
- AI 驱动的壁纸推荐
- 基于情绪的建议（可选：集成日历/天气）

#### 第四阶段：跨平台（未来）

**10. Windows 支持 (P2)**
- Tauri 跨平台支持
- Windows 系统托盘
- Windows 原生通知
- 保持功能对等

---

## 4. 用户故事

### MVP 故事

**作为用户，我希望：**
1. 从热门来源获取壁纸，以便有各种美丽的图片。
2. 一键将壁纸设置为我的桌面背景。
3. 按计划自动更换壁纸，让桌面保持新鲜感。
4. 从菜单栏快速访问应用，无需打开完整窗口即可更换壁纸。
5. 配置壁纸偏好（分辨率、类别、频率），让应用符合我的风格。
6. 设置壁纸前查看预览，知道会得到什么。

### 未来故事

7. 使用 AI 生成自定义壁纸，拥有独特的图片。
8. 创建我最喜欢的壁纸集合，按主题组织它们。
9. 在 Windows 上使用应用，在设备间获得相同的体验。

---

## 5. 非功能性需求

### 性能
- 应用启动时间 < 2 秒
- 壁纸获取时间 < 5 秒（已缓存）
- 壁纸下载时间 < 30 秒（取决于图片大小）
- 内存使用 < 100MB（空闲）

### 可靠性
- 优雅处理网络故障
- 失败下载自动重试
- 持久化缓存（应用重启后仍保留）
- 应用崩溃不丢失数据

### 可用性
- 原生 macOS 感觉和键盘快捷键
- 直观的 UI 和清晰的反馈
- 可访问设计（符合 WCAG AA 标准）
- 在所有屏幕尺寸上响应式（如果是窗口应用）

### 安全性
- 安全的 API 密钥存储（Keychain 集成）
- 未经同意不向第三方发送数据
- 用于 macOS 分发的代码签名

### 可维护性
- 干净、模块化的代码架构
- 全面的错误处理
- 文档齐全的 API
- AI 友好的代码结构

---

## 6. 技术架构

### 6.1 高层架构

```
┌─────────────────────────────────────────┐
│         前端 (React + Vite)            │
│  - UI 组件                            │
│  - 状态管理                           │
│  - 菜单栏集成                         │
└──────────────┬──────────────────────────┘
               │ Tauri IPC
               ▼
┌─────────────────────────────────────────┐
│      后端 (Rust + Tauri)              │
│  - 壁纸命令                           │
│  - API 处理器                         │
│  - 调度服务                           │
│  - 缓存管理                           │
└──────────────┬──────────────────────────┘
               │
               ├─► wallpaper crate (系统 API)
               ├─► reqwest (HTTP 客户端)
               ├─► tokio (异步运行时)
               └─► 文件系统 (缓存)
```

### 6.2 关键模块

**前端模块：**
- `components/` - React UI 组件
- `hooks/` - 自定义 React hooks（如 useWallpaper）
- `services/` - API 服务层（调用 Tauri 命令）
- `store/` - 状态管理
- `types/` - TypeScript 类型定义

**后端模块：**
- `commands/` - Tauri 命令处理器
- `services/` - 业务逻辑（获取器、调度器、缓存）
- `sources/` - 壁纸来源实现（Unsplash、Wallhaven 等）
- `utils/` - 辅助函数

---

## 7. 开发路线图

### 2026 年 Q1：基础建设
- [x] 项目设置和架构设计
- [ ] Tauri 2.0 项目初始化
- [ ] 基础菜单栏应用结构
- [ ] 壁纸 API 集成（`wallpaper` crate）
- [ ] 第一个壁纸来源（Unsplash）

### 2026 年 Q2：MVP
- [ ] 完成壁纸获取功能
- [ ] 实现自动更换定时器
- [ ] 设置 UI 和持久化
- [ ] 测试和错误修复
- [ ] v1.0 发布

### 2026 年 Q3：增强
- [ ] 高级调度
- [ ] 壁纸历史和收藏
- [ ] 额外的壁纸来源
- [ ] 性能优化
- [ ] v1.5 发布

### 2026 年 Q4：AI 集成
- [ ] AI API 集成（Stable Diffusion/DALL-E）
- [ ] 基于提示词生成的 UI
- [ ] 风格预设
- [ ] v2.0 发布

### 2027 年：扩展
- [ ] Windows 支持
- [ ] 智能策展（基于 ML）
- [ ] 社区功能（分享、集合）

---

## 8. 风险和缓解措施

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 壁纸来源的 API 速率限制 | 高 | 实现缓存、多来源支持、遵守速率限制 |
| `wallpaper` crate 兼容性问题 | 中 | 在目标操作系统上充分测试、向上游贡献修复 |
| Tauri 2.0 重大变更 | 中 | 固定到稳定版本、监控发布说明 |
| AI API 成本和可靠性 | 高 | 支持多个提供商、实现回退、允许本地 AI（SD） |
| macOS App Store 审批 | 中 | 遵循 Apple 指南、代码签名、隐私政策 |

---

## 9. 成功指标

**产品成功：**
- 首月下载量 1000+
- Mac App Store 评分 4.5+（如果发布）
- 30 天后留存率 70%+

**技术成功：**
- 崩溃率 < 2%
- API 错误率 < 5%
- 应用大小目标 50MB

**用户参与度：**
- 平均每位用户每周更换壁纸 3+ 次
- 20%+ 用户使用收藏功能
- 10%+ 用户启用 AI 生成（功能上线后）

---

## 10. 未决问题

1. **前端框架：** React vs Vue vs Svelte？（推荐 React，适合 AI 代码生成）
2. **UI 库：** shadcn/ui vs Chakra UI vs Mantine？（推荐 shadcn/ui，现代化、可访问的组件）
3. **AI 集成：** 优先考虑哪个 AI 提供商？（Stable Diffusion 灵活性强，DALL-E 易用）
4. **商业模式：** 免费vs 付费vs 免费增值？（推荐免费增值：基础功能免费，AI 生成付费）

---

## 11. 参考资料

- [Tauri 文档](https://tauri.app/)
- [`wallpaper` crate](https://docs.rs/wallpaper/)
- [Unsplash API](https://unsplash.com/developers)
- [Wallhaven API](https://wallhaven.cc/help/api)
- [Bing 每日壁纸 API](https://www.microsoft.com/en-us/bing/apis/bing-image-search-api)
- [shadcn/ui](https://ui.shadcn.com/)

---

**文档版本:** 1.0
**最后更新:** 2026 年 1 月 28 日
**状态:** 草稿
